# 리눅스 디바이스 드라이버

## 임시 이름:
리눅스의 개발 요소
### 내용:
1. bootloader(u-boot)
2. device tree(overlay)
3. kernel(driver)
4. rootfilesystem(buildroot)

### 키워드:

---
## 임시 이름:
리눅스의 장점
### 요약:
리눅스는 **네트워크·성능·안정성·확장성·자율성**을 동시에 만족하는 OS이기 때문에 서버, 클라우드, 네트워크 장비, 임베디드까지 지배하고 있다.
### 키워드

---
## 임시 이름:
콘솔과 터미널
### 내용:
콘솔 : 물리 TTY
/dev/tty1
uart는 ttyS0를 쓴다
...
터미널 : 가상 TTY
/dev/pts/0
...
현재 터미널
/dev/tty
### 키워드

---
## 임시 이름:
리눅스의 실행환경
### 요약:
리눅스 포팅이란 특정 보드에 리눅스를 실행시키기 위해 각각의 하드웨어에 작업하는 일련의 과정을 일컫는다
### 내용:
1. CPU
    porting : X (manufacturer)
2. memory
    porting : 데이터시트를 참고, timing을 찾아서 커널에 맞춰줘야한다
3. console
    stdin, stdout, stderr
    일반적으로 구성이 되어 있지만 uart의 경우에는 필요할 수 있다
4. io (device/peripherals)
    장치 타입의 종류 마다 드라이버를 작성하는 방법이 다르다
    char  
    block 
    ...
    porting : driver 작성


---
## 임시 이름:
리눅스 커널 소스트리
### 내용:
주요 커널 소스
arch : 아키텍쳐 종속 코드
documentation : 커널 소스 문서
drivers : 디바이스 드라이버
include : 커널 헤더 파일들
init : 커널 부트와 초기화 관련
  - start_kernel : 커널이 시작할 때 최초로 실행되는 c 함수
ipc : 프로세스간 통신 코드
lib : 유틸리티 루틴


---
## 임시 이름:
드라이버 작성 시 고려 사항
### 요약:
실행영역 커널영역
  - 드라이버는 커널의 부분
  - 오작동 시 치명적 피해

콜백함수제공

커널기능이용
  - 메모리 할당
  - 인터럽트
  - 동기화

제작형태  결정
  - 커널형태
  - 모듈형태

---
## 임시 이름:
드라이버 소스 로케이션
### 한 줄 요약:

### 내용:
tree : kernel tree

in-tree
  /drivers/...
  커널 소스 트리 내에 hello.c
ex-tree
  /home/user/...

### 키워드:

### 질문:


---
## 임시 이름:
드라이버 제작 형태
### 요약:
dht11.c -> dht11.o ->
1. vmlinux : 커널 포함 형태
  - zImage에 내장
2. dht11.ko (*선호) : 커널 모듈에 탑재
  - kernel object
### 키워드:


---
## 임시 이름:
커널 소스
### 요약:
`/boot` 
1. kernel.org
2. linux-x.x.x.gz
  - kernel
    - vmlinux -> Image -> zImage (kernel8.img)
  - driverSource
    - `/lib/modules/6.1.21-v8+/kernel/drivers/`
  - divice tree
    - bcm2711-rpi-4-b.dtb
### 키워드:
start.elf : bootloader

---

## 임시 이름:
디바이스의 종류
### 요약:
문자 디바이스
- 바이트 단위 입출력
- /dev의 node를 통해 접근
    - /dev/console
    - /dev/ttyS0
- 주로 순차 참조
- keyboard, mouse, serial, modem, video,...

블록 디바이스
- 블록 단위 입출력 (버퍼 사용)
- /dev의 node를 통해 접근
    - /dev/sda
- 순차 및 랜덤 참조
- hard disk, cd-rom, usb disk,...

소스코드 위치
- drivers/char
- drivers/block
- drivers/misc
- drivers/input
- drivers/video
- drivers/i2c
- drivers/iio

### 키워드:

---

## 임시 이름:
유저 영역에서 커널 영역의 자료 참조
### 요약:
`/proc` : 커널이 오픈한 정보를 인터렉티브하게 열람하는 곳
- /cpuinfo : cpu의 정보
- /meminfo : 메모리 정보
- /proc : 커널의 명령행 인자
`/sys`  : 드라이버가 오픈한 정보를 인터렉티브하게 열람하는 곳
- /firmware
- bus
- device
- class

### 키워드:

---

## 임시 이름:
리눅스 커널 설치 및 빌드
### 요약:
upstream : 원본 저장소
[https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/refs/tags]

fetch : 원격 저장소에서 소스 코드를 가져오는 단계
unpack : 압축된 소스를 해제하는 단계
patch : 소스 코드에 수정 사항을 적용
configure : 커널 빌드 옵션을 설정하는 단계
- `$ apt install libncurses-dev flex bison`
- `$ make menuconfig`
- `$ export KERNEL=kernel8`
- `$ export ARCH=arm64`
`.config`에 설정이 반영된다
makefile
- obj-$(CONFIG_DHT11) += dht11.o
    - obj-m -> xxx.ko
    - obj-y -> vmlinux -> zImage
    - obj-  -> no compile

compile
link
install
exec

### 키워드:

---

## 임시 이름:
리눅스 디바이스 트리 구조
### 요약:
1. source files
    - .dts     (.c)
    - .dtsi    (.h)
2. complier
    - dtc
3. binaries
    - .dtb     (device tree blob)
    - .dtbo    (dtb overlay)


### 키워드:

---

## 임시 이름:
모듈 빌드 설정 및 실행
### 요약:
`/lib/modules/???`

`$ insmod .ko` : 모듈 삽입
`$ lsmod`      : 현재 탑재 된 모듈
`$ rmmod`      : 모듈 삭제

`printk()`     : 기본적으로 콘솔에 출력
- `$ cat /var/log/messages`
`$ dmesg`      : 모듈 메세지 출력
- `-c`         : 출력 후 클리어

### 키워드:

---

## 임시 이름:

### 요약:

### 키워드:

---

## 임시 이름:

### 요약:

### 키워드:

---

## 임시 이름:

### 요약:

### 키워드:

---

## 임시 이름:

### 요약:

### 키워드:

---

## 임시 이름:

### 요약:

### 키워드:

---